@page "/ManagePosts"
@using BlazorServer2.Data;
@using BlazorServer2.Models;
@using BlazorServer2.Pages.MiscComponents;
@attribute [Authorize(Roles = "Author")]
@inject ApplicationDbContext _context


@*
    /*
    I would like to have 2 sections

    1)
        create post,
        see real time what it will look like,
        have iframe with that html thing?


    2)
        List posts, offer delete (edit later)


    Extras:
        Module for green checkmark on submit success,


    */
*@


<EditPost PostInProgress="PostInProgress" RefreshPostsCall="LoadPosts" />

<br />

<EditPosts BlogPosts="BlogPosts" DeletePostCallback="RemovePost" />





@code {
    [Parameter]
    public BlogPost PostInProgress { get; set; } = new();

    public List<BlogPost> BlogPosts { get; set; } = default!;

    //public EventCallback RefreshPostsCall { get; set; }

    protected override Task OnInitializedAsync()
    {
        // get posts from db
        BlogPosts = _context.BlogPosts.ToList();

        return base.OnInitializedAsync();
    }

    //
    private void LoadPosts()
    {
        BlogPosts = _context.BlogPosts.ToList();
        StateHasChanged();
    }

    private void RemovePost(BlogPost blogPost)
    {
        BlogPosts.Remove(blogPost);
        _context.BlogPosts.Remove(blogPost);
        _context.SaveChanges();
        StateHasChanged();
    }
}
